{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CountDocumentsOperation = void 0;\n\nconst aggregate_1 = require(\"./aggregate\");\n/** @internal */\n\n\nclass CountDocumentsOperation extends aggregate_1.AggregateOperation {\n  constructor(collection, query, options) {\n    const pipeline = [];\n    pipeline.push({\n      $match: query\n    });\n\n    if (typeof options.skip === 'number') {\n      pipeline.push({\n        $skip: options.skip\n      });\n    }\n\n    if (typeof options.limit === 'number') {\n      pipeline.push({\n        $limit: options.limit\n      });\n    }\n\n    pipeline.push({\n      $group: {\n        _id: 1,\n        n: {\n          $sum: 1\n        }\n      }\n    });\n    super(collection.s.namespace, pipeline, options);\n  }\n\n  execute(server, session, callback) {\n    super.execute(server, session, (err, result) => {\n      if (err || !result) {\n        callback(err);\n        return;\n      } // NOTE: We're avoiding creating a cursor here to reduce the callstack.\n\n\n      const response = result;\n\n      if (response.cursor == null || response.cursor.firstBatch == null) {\n        callback(undefined, 0);\n        return;\n      }\n\n      const docs = response.cursor.firstBatch;\n      callback(undefined, docs.length ? docs[0].n : 0);\n    });\n  }\n\n}\n\nexports.CountDocumentsOperation = CountDocumentsOperation;","map":{"version":3,"sources":["../../src/operations/count_documents.ts"],"names":[],"mappings":";;;;;;;AAKA,MAAA,WAAA,GAAA,OAAA,CAAA,aAAA,CAAA;AAUA;;;AACA,MAAa,uBAAb,SAA6C,WAAA,CAAA,kBAA7C,CAAuE;EACrE,WAAA,CAAY,UAAZ,EAAoC,KAApC,EAAqD,OAArD,EAAmF;IACjF,MAAM,QAAQ,GAAG,EAAjB;IACA,QAAQ,CAAC,IAAT,CAAc;MAAE,MAAM,EAAE;IAAV,CAAd;;IAEA,IAAI,OAAO,OAAO,CAAC,IAAf,KAAwB,QAA5B,EAAsC;MACpC,QAAQ,CAAC,IAAT,CAAc;QAAE,KAAK,EAAE,OAAO,CAAC;MAAjB,CAAd;IACD;;IAED,IAAI,OAAO,OAAO,CAAC,KAAf,KAAyB,QAA7B,EAAuC;MACrC,QAAQ,CAAC,IAAT,CAAc;QAAE,MAAM,EAAE,OAAO,CAAC;MAAlB,CAAd;IACD;;IAED,QAAQ,CAAC,IAAT,CAAc;MAAE,MAAM,EAAE;QAAE,GAAG,EAAE,CAAP;QAAU,CAAC,EAAE;UAAE,IAAI,EAAE;QAAR;MAAb;IAAV,CAAd;IAEA,MAAM,UAAU,CAAC,CAAX,CAAa,SAAnB,EAA8B,QAA9B,EAAwC,OAAxC;EACD;;EAEQ,OAAO,CACd,MADc,EAEd,OAFc,EAGd,QAHc,EAGY;IAE1B,MAAM,OAAN,CAAc,MAAd,EAAsB,OAAtB,EAA+B,CAAC,GAAD,EAAM,MAAN,KAAgB;MAC7C,IAAI,GAAG,IAAI,CAAC,MAAZ,EAAoB;QAClB,QAAQ,CAAC,GAAD,CAAR;QACA;MACD,CAJ4C,CAM7C;;;MACA,MAAM,QAAQ,GAAG,MAAjB;;MACA,IAAI,QAAQ,CAAC,MAAT,IAAmB,IAAnB,IAA2B,QAAQ,CAAC,MAAT,CAAgB,UAAhB,IAA8B,IAA7D,EAAmE;QACjE,QAAQ,CAAC,SAAD,EAAY,CAAZ,CAAR;QACA;MACD;;MAED,MAAM,IAAI,GAAG,QAAQ,CAAC,MAAT,CAAgB,UAA7B;MACA,QAAQ,CAAC,SAAD,EAAY,IAAI,CAAC,MAAL,GAAc,IAAI,CAAC,CAAD,CAAJ,CAAQ,CAAtB,GAA0B,CAAtC,CAAR;IACD,CAfD;EAgBD;;AAvCoE;;AAAvE,OAAA,CAAA,uBAAA,GAAA,uBAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CountDocumentsOperation = void 0;\nconst aggregate_1 = require(\"./aggregate\");\n/** @internal */\nclass CountDocumentsOperation extends aggregate_1.AggregateOperation {\n    constructor(collection, query, options) {\n        const pipeline = [];\n        pipeline.push({ $match: query });\n        if (typeof options.skip === 'number') {\n            pipeline.push({ $skip: options.skip });\n        }\n        if (typeof options.limit === 'number') {\n            pipeline.push({ $limit: options.limit });\n        }\n        pipeline.push({ $group: { _id: 1, n: { $sum: 1 } } });\n        super(collection.s.namespace, pipeline, options);\n    }\n    execute(server, session, callback) {\n        super.execute(server, session, (err, result) => {\n            if (err || !result) {\n                callback(err);\n                return;\n            }\n            // NOTE: We're avoiding creating a cursor here to reduce the callstack.\n            const response = result;\n            if (response.cursor == null || response.cursor.firstBatch == null) {\n                callback(undefined, 0);\n                return;\n            }\n            const docs = response.cursor.firstBatch;\n            callback(undefined, docs.length ? docs[0].n : 0);\n        });\n    }\n}\nexports.CountDocumentsOperation = CountDocumentsOperation;\n//# sourceMappingURL=count_documents.js.map"]},"metadata":{},"sourceType":"script"}