{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RenameOperation = void 0;\n\nconst collection_1 = require(\"../collection\");\n\nconst error_1 = require(\"../error\");\n\nconst utils_1 = require(\"../utils\");\n\nconst operation_1 = require(\"./operation\");\n\nconst run_command_1 = require(\"./run_command\");\n/** @internal */\n\n\nclass RenameOperation extends run_command_1.RunAdminCommandOperation {\n  constructor(collection, newName, options) {\n    // Check the collection name\n    (0, utils_1.checkCollectionName)(newName); // Build the command\n\n    const renameCollection = collection.namespace;\n    const toCollection = collection.s.namespace.withCollection(newName).toString();\n    const dropTarget = typeof options.dropTarget === 'boolean' ? options.dropTarget : false;\n    const cmd = {\n      renameCollection: renameCollection,\n      to: toCollection,\n      dropTarget: dropTarget\n    };\n    super(collection, cmd, options);\n    this.options = options;\n    this.collection = collection;\n    this.newName = newName;\n  }\n\n  execute(server, session, callback) {\n    const coll = this.collection;\n    super.execute(server, session, (err, doc) => {\n      if (err) return callback(err); // We have an error\n\n      if (doc === null || doc === void 0 ? void 0 : doc.errmsg) {\n        return callback(new error_1.MongoServerError(doc));\n      }\n\n      let newColl;\n\n      try {\n        newColl = new collection_1.Collection(coll.s.db, this.newName, coll.s.options);\n      } catch (err) {\n        return callback(err);\n      }\n\n      return callback(undefined, newColl);\n    });\n  }\n\n}\n\nexports.RenameOperation = RenameOperation;\n(0, operation_1.defineAspects)(RenameOperation, [operation_1.Aspect.WRITE_OPERATION]);","map":{"version":3,"sources":["../../src/operations/rename.ts"],"names":[],"mappings":";;;;;;;AACA,MAAA,YAAA,GAAA,OAAA,CAAA,eAAA,CAAA;;AACA,MAAA,OAAA,GAAA,OAAA,CAAA,UAAA,CAAA;;AAGA,MAAA,OAAA,GAAA,OAAA,CAAA,UAAA,CAAA;;AAEA,MAAA,WAAA,GAAA,OAAA,CAAA,aAAA,CAAA;;AACA,MAAA,aAAA,GAAA,OAAA,CAAA,eAAA,CAAA;AAUA;;;AACA,MAAa,eAAb,SAAqC,aAAA,CAAA,wBAArC,CAA6D;EAK3D,WAAA,CAAY,UAAZ,EAAoC,OAApC,EAAqD,OAArD,EAA2E;IACzE;IACA,CAAA,GAAA,OAAA,CAAA,mBAAA,EAAoB,OAApB,EAFyE,CAIzE;;IACA,MAAM,gBAAgB,GAAG,UAAU,CAAC,SAApC;IACA,MAAM,YAAY,GAAG,UAAU,CAAC,CAAX,CAAa,SAAb,CAAuB,cAAvB,CAAsC,OAAtC,EAA+C,QAA/C,EAArB;IACA,MAAM,UAAU,GAAG,OAAO,OAAO,CAAC,UAAf,KAA8B,SAA9B,GAA0C,OAAO,CAAC,UAAlD,GAA+D,KAAlF;IACA,MAAM,GAAG,GAAG;MAAE,gBAAgB,EAAE,gBAApB;MAAsC,EAAE,EAAE,YAA1C;MAAwD,UAAU,EAAE;IAApE,CAAZ;IAEA,MAAM,UAAN,EAAkB,GAAlB,EAAuB,OAAvB;IACA,KAAK,OAAL,GAAe,OAAf;IACA,KAAK,UAAL,GAAkB,UAAlB;IACA,KAAK,OAAL,GAAe,OAAf;EACD;;EAEQ,OAAO,CACd,MADc,EAEd,OAFc,EAGd,QAHc,EAGgB;IAE9B,MAAM,IAAI,GAAG,KAAK,UAAlB;IAEA,MAAM,OAAN,CAAc,MAAd,EAAsB,OAAtB,EAA+B,CAAC,GAAD,EAAM,GAAN,KAAa;MAC1C,IAAI,GAAJ,EAAS,OAAO,QAAQ,CAAC,GAAD,CAAf,CADiC,CAE1C;;MACA,IAAI,GAAG,KAAA,IAAH,IAAA,GAAG,KAAA,KAAA,CAAH,GAAG,KAAA,CAAH,GAAA,GAAG,CAAE,MAAT,EAAiB;QACf,OAAO,QAAQ,CAAC,IAAI,OAAA,CAAA,gBAAJ,CAAqB,GAArB,CAAD,CAAf;MACD;;MAED,IAAI,OAAJ;;MACA,IAAI;QACF,OAAO,GAAG,IAAI,YAAA,CAAA,UAAJ,CAAe,IAAI,CAAC,CAAL,CAAO,EAAtB,EAA0B,KAAK,OAA/B,EAAwC,IAAI,CAAC,CAAL,CAAO,OAA/C,CAAV;MACD,CAFD,CAEE,OAAO,GAAP,EAAY;QACZ,OAAO,QAAQ,CAAC,GAAD,CAAf;MACD;;MAED,OAAO,QAAQ,CAAC,SAAD,EAAY,OAAZ,CAAf;IACD,CAfD;EAgBD;;AA5C0D;;AAA7D,OAAA,CAAA,eAAA,GAAA,eAAA;AA+CA,CAAA,GAAA,WAAA,CAAA,aAAA,EAAc,eAAd,EAA+B,CAAC,WAAA,CAAA,MAAA,CAAO,eAAR,CAA/B","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RenameOperation = void 0;\nconst collection_1 = require(\"../collection\");\nconst error_1 = require(\"../error\");\nconst utils_1 = require(\"../utils\");\nconst operation_1 = require(\"./operation\");\nconst run_command_1 = require(\"./run_command\");\n/** @internal */\nclass RenameOperation extends run_command_1.RunAdminCommandOperation {\n    constructor(collection, newName, options) {\n        // Check the collection name\n        (0, utils_1.checkCollectionName)(newName);\n        // Build the command\n        const renameCollection = collection.namespace;\n        const toCollection = collection.s.namespace.withCollection(newName).toString();\n        const dropTarget = typeof options.dropTarget === 'boolean' ? options.dropTarget : false;\n        const cmd = { renameCollection: renameCollection, to: toCollection, dropTarget: dropTarget };\n        super(collection, cmd, options);\n        this.options = options;\n        this.collection = collection;\n        this.newName = newName;\n    }\n    execute(server, session, callback) {\n        const coll = this.collection;\n        super.execute(server, session, (err, doc) => {\n            if (err)\n                return callback(err);\n            // We have an error\n            if (doc === null || doc === void 0 ? void 0 : doc.errmsg) {\n                return callback(new error_1.MongoServerError(doc));\n            }\n            let newColl;\n            try {\n                newColl = new collection_1.Collection(coll.s.db, this.newName, coll.s.options);\n            }\n            catch (err) {\n                return callback(err);\n            }\n            return callback(undefined, newColl);\n        });\n    }\n}\nexports.RenameOperation = RenameOperation;\n(0, operation_1.defineAspects)(RenameOperation, [operation_1.Aspect.WRITE_OPERATION]);\n//# sourceMappingURL=rename.js.map"]},"metadata":{},"sourceType":"script"}