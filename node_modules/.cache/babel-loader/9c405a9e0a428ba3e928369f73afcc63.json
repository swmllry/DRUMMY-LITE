{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isResumableError = exports.isNetworkTimeoutError = exports.isSDAMUnrecoverableError = exports.isNodeShuttingDownError = exports.isRetryableReadError = exports.isRetryableWriteError = exports.needsRetryableWriteLabel = exports.MongoWriteConcernError = exports.MongoServerSelectionError = exports.MongoSystemError = exports.MongoMissingDependencyError = exports.MongoMissingCredentialsError = exports.MongoCompatibilityError = exports.MongoInvalidArgumentError = exports.MongoParseError = exports.MongoNetworkTimeoutError = exports.MongoNetworkError = exports.isNetworkErrorBeforeHandshake = exports.MongoTopologyClosedError = exports.MongoCursorExhaustedError = exports.MongoServerClosedError = exports.MongoCursorInUseError = exports.MongoUnexpectedServerResponseError = exports.MongoGridFSChunkError = exports.MongoGridFSStreamError = exports.MongoTailableCursorError = exports.MongoChangeStreamError = exports.MongoAWSError = exports.MongoKerberosError = exports.MongoExpiredSessionError = exports.MongoTransactionError = exports.MongoNotConnectedError = exports.MongoDecompressionError = exports.MongoBatchReExecutionError = exports.MongoRuntimeError = exports.MongoAPIError = exports.MongoDriverError = exports.MongoServerError = exports.MongoError = exports.MongoErrorLabel = exports.GET_MORE_RESUMABLE_CODES = exports.MONGODB_ERROR_CODES = exports.NODE_IS_RECOVERING_ERROR_MESSAGE = exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = void 0;\n/** @internal */\n\nconst kErrorLabels = Symbol('errorLabels');\n/**\n * @internal\n * The legacy error message from the server that indicates the node is not a writable primary\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\n\nexports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = new RegExp('not master', 'i');\n/**\n * @internal\n * The legacy error message from the server that indicates the node is not a primary or secondary\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\n\nexports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = new RegExp('not master or secondary', 'i');\n/**\n * @internal\n * The error message from the server that indicates the node is recovering\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\n\nexports.NODE_IS_RECOVERING_ERROR_MESSAGE = new RegExp('node is recovering', 'i');\n/** @internal MongoDB Error Codes */\n\nexports.MONGODB_ERROR_CODES = Object.freeze({\n  HostUnreachable: 6,\n  HostNotFound: 7,\n  NetworkTimeout: 89,\n  ShutdownInProgress: 91,\n  PrimarySteppedDown: 189,\n  ExceededTimeLimit: 262,\n  SocketException: 9001,\n  NotWritablePrimary: 10107,\n  InterruptedAtShutdown: 11600,\n  InterruptedDueToReplStateChange: 11602,\n  NotPrimaryNoSecondaryOk: 13435,\n  NotPrimaryOrSecondary: 13436,\n  StaleShardVersion: 63,\n  StaleEpoch: 150,\n  StaleConfig: 13388,\n  RetryChangeStream: 234,\n  FailedToSatisfyReadPreference: 133,\n  CursorNotFound: 43,\n  LegacyNotPrimary: 10058,\n  WriteConcernFailed: 64,\n  NamespaceNotFound: 26,\n  IllegalOperation: 20,\n  MaxTimeMSExpired: 50,\n  UnknownReplWriteConcern: 79,\n  UnsatisfiableWriteConcern: 100\n}); // From spec@https://github.com/mongodb/specifications/blob/f93d78191f3db2898a59013a7ed5650352ef6da8/source/change-streams/change-streams.rst#resumable-error\n\nexports.GET_MORE_RESUMABLE_CODES = new Set([exports.MONGODB_ERROR_CODES.HostUnreachable, exports.MONGODB_ERROR_CODES.HostNotFound, exports.MONGODB_ERROR_CODES.NetworkTimeout, exports.MONGODB_ERROR_CODES.ShutdownInProgress, exports.MONGODB_ERROR_CODES.PrimarySteppedDown, exports.MONGODB_ERROR_CODES.ExceededTimeLimit, exports.MONGODB_ERROR_CODES.SocketException, exports.MONGODB_ERROR_CODES.NotWritablePrimary, exports.MONGODB_ERROR_CODES.InterruptedAtShutdown, exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange, exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk, exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary, exports.MONGODB_ERROR_CODES.StaleShardVersion, exports.MONGODB_ERROR_CODES.StaleEpoch, exports.MONGODB_ERROR_CODES.StaleConfig, exports.MONGODB_ERROR_CODES.RetryChangeStream, exports.MONGODB_ERROR_CODES.FailedToSatisfyReadPreference, exports.MONGODB_ERROR_CODES.CursorNotFound]);\n/** @public */\n\nexports.MongoErrorLabel = Object.freeze({\n  RetryableWriteError: 'RetryableWriteError',\n  TransientTransactionError: 'TransientTransactionError',\n  UnknownTransactionCommitResult: 'UnknownTransactionCommitResult',\n  ResumableChangeStreamError: 'ResumableChangeStreamError',\n  HandshakeError: 'HandshakeError'\n});\n/**\n * @public\n * @category Error\n *\n * @privateRemarks\n * CSFLE has a dependency on this error, it uses the constructor with a string argument\n */\n\nclass MongoError extends Error {\n  constructor(message) {\n    if (message instanceof Error) {\n      super(message.message);\n    } else {\n      super(message);\n    }\n\n    this[kErrorLabels] = new Set();\n  }\n\n  get name() {\n    return 'MongoError';\n  }\n  /** Legacy name for server error responses */\n\n\n  get errmsg() {\n    return this.message;\n  }\n  /**\n   * Checks the error to see if it has an error label\n   *\n   * @param label - The error label to check for\n   * @returns returns true if the error has the provided error label\n   */\n\n\n  hasErrorLabel(label) {\n    return this[kErrorLabels].has(label);\n  }\n\n  addErrorLabel(label) {\n    this[kErrorLabels].add(label);\n  }\n\n  get errorLabels() {\n    return Array.from(this[kErrorLabels]);\n  }\n\n}\n\nexports.MongoError = MongoError;\n/**\n * An error coming from the mongo server\n *\n * @public\n * @category Error\n */\n\nclass MongoServerError extends MongoError {\n  constructor(message) {\n    super(message.message || message.errmsg || message.$err || 'n/a');\n\n    if (message.errorLabels) {\n      this[kErrorLabels] = new Set(message.errorLabels);\n    }\n\n    for (const name in message) {\n      if (name !== 'errorLabels' && name !== 'errmsg' && name !== 'message') this[name] = message[name];\n    }\n  }\n\n  get name() {\n    return 'MongoServerError';\n  }\n\n}\n\nexports.MongoServerError = MongoServerError;\n/**\n * An error generated by the driver\n *\n * @public\n * @category Error\n */\n\nclass MongoDriverError extends MongoError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoDriverError';\n  }\n\n}\n\nexports.MongoDriverError = MongoDriverError;\n/**\n * An error generated when the driver API is used incorrectly\n *\n * @privateRemarks\n * Should **never** be directly instantiated\n *\n * @public\n * @category Error\n */\n\nclass MongoAPIError extends MongoDriverError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoAPIError';\n  }\n\n}\n\nexports.MongoAPIError = MongoAPIError;\n/**\n * An error generated when the driver encounters unexpected input\n * or reaches an unexpected/invalid internal state\n *\n * @privateRemarks\n * Should **never** be directly instantiated.\n *\n * @public\n * @category Error\n */\n\nclass MongoRuntimeError extends MongoDriverError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoRuntimeError';\n  }\n\n}\n\nexports.MongoRuntimeError = MongoRuntimeError;\n/**\n * An error generated when a batch command is re-executed after one of the commands in the batch\n * has failed\n *\n * @public\n * @category Error\n */\n\nclass MongoBatchReExecutionError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'This batch has already been executed, create new batch to execute';\n    super(message);\n  }\n\n  get name() {\n    return 'MongoBatchReExecutionError';\n  }\n\n}\n\nexports.MongoBatchReExecutionError = MongoBatchReExecutionError;\n/**\n * An error generated when the driver fails to decompress\n * data received from the server.\n *\n * @public\n * @category Error\n */\n\nclass MongoDecompressionError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoDecompressionError';\n  }\n\n}\n\nexports.MongoDecompressionError = MongoDecompressionError;\n/**\n * An error thrown when the user attempts to operate on a database or collection through a MongoClient\n * that has not yet successfully called the \"connect\" method\n *\n * @public\n * @category Error\n */\n\nclass MongoNotConnectedError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoNotConnectedError';\n  }\n\n}\n\nexports.MongoNotConnectedError = MongoNotConnectedError;\n/**\n * An error generated when the user makes a mistake in the usage of transactions.\n * (e.g. attempting to commit a transaction with a readPreference other than primary)\n *\n * @public\n * @category Error\n */\n\nclass MongoTransactionError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoTransactionError';\n  }\n\n}\n\nexports.MongoTransactionError = MongoTransactionError;\n/**\n * An error generated when the user attempts to operate\n * on a session that has expired or has been closed.\n *\n * @public\n * @category Error\n */\n\nclass MongoExpiredSessionError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Cannot use a session that has ended';\n    super(message);\n  }\n\n  get name() {\n    return 'MongoExpiredSessionError';\n  }\n\n}\n\nexports.MongoExpiredSessionError = MongoExpiredSessionError;\n/**\n * A error generated when the user attempts to authenticate\n * via Kerberos, but fails to connect to the Kerberos client.\n *\n * @public\n * @category Error\n */\n\nclass MongoKerberosError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoKerberosError';\n  }\n\n}\n\nexports.MongoKerberosError = MongoKerberosError;\n/**\n * A error generated when the user attempts to authenticate\n * via AWS, but fails\n *\n * @public\n * @category Error\n */\n\nclass MongoAWSError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoAWSError';\n  }\n\n}\n\nexports.MongoAWSError = MongoAWSError;\n/**\n * An error generated when a ChangeStream operation fails to execute.\n *\n * @public\n * @category Error\n */\n\nclass MongoChangeStreamError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoChangeStreamError';\n  }\n\n}\n\nexports.MongoChangeStreamError = MongoChangeStreamError;\n/**\n * An error thrown when the user calls a function or method not supported on a tailable cursor\n *\n * @public\n * @category Error\n */\n\nclass MongoTailableCursorError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Tailable cursor does not support this operation';\n    super(message);\n  }\n\n  get name() {\n    return 'MongoTailableCursorError';\n  }\n\n}\n\nexports.MongoTailableCursorError = MongoTailableCursorError;\n/** An error generated when a GridFSStream operation fails to execute.\n *\n * @public\n * @category Error\n */\n\nclass MongoGridFSStreamError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoGridFSStreamError';\n  }\n\n}\n\nexports.MongoGridFSStreamError = MongoGridFSStreamError;\n/**\n * An error generated when a malformed or invalid chunk is\n * encountered when reading from a GridFSStream.\n *\n * @public\n * @category Error\n */\n\nclass MongoGridFSChunkError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoGridFSChunkError';\n  }\n\n}\n\nexports.MongoGridFSChunkError = MongoGridFSChunkError;\n/**\n * An error generated when a **parsable** unexpected response comes from the server.\n * This is generally an error where the driver in a state expecting a certain behavior to occur in\n * the next message from MongoDB but it receives something else.\n * This error **does not** represent an issue with wire message formatting.\n *\n * #### Example\n * When an operation fails, it is the driver's job to retry it. It must perform serverSelection\n * again to make sure that it attempts the operation against a server in a good state. If server\n * selection returns a server that does not support retryable operations, this error is used.\n * This scenario is unlikely as retryable support would also have been determined on the first attempt\n * but it is possible the state change could report a selectable server that does not support retries.\n *\n * @public\n * @category Error\n */\n\nclass MongoUnexpectedServerResponseError extends MongoRuntimeError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoUnexpectedServerResponseError';\n  }\n\n}\n\nexports.MongoUnexpectedServerResponseError = MongoUnexpectedServerResponseError;\n/**\n * An error thrown when the user attempts to add options to a cursor that has already been\n * initialized\n *\n * @public\n * @category Error\n */\n\nclass MongoCursorInUseError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Cursor is already initialized';\n    super(message);\n  }\n\n  get name() {\n    return 'MongoCursorInUseError';\n  }\n\n}\n\nexports.MongoCursorInUseError = MongoCursorInUseError;\n/**\n * An error generated when an attempt is made to operate\n * on a closed/closing server.\n *\n * @public\n * @category Error\n */\n\nclass MongoServerClosedError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Server is closed';\n    super(message);\n  }\n\n  get name() {\n    return 'MongoServerClosedError';\n  }\n\n}\n\nexports.MongoServerClosedError = MongoServerClosedError;\n/**\n * An error thrown when an attempt is made to read from a cursor that has been exhausted\n *\n * @public\n * @category Error\n */\n\nclass MongoCursorExhaustedError extends MongoAPIError {\n  constructor(message) {\n    super(message || 'Cursor is exhausted');\n  }\n\n  get name() {\n    return 'MongoCursorExhaustedError';\n  }\n\n}\n\nexports.MongoCursorExhaustedError = MongoCursorExhaustedError;\n/**\n * An error generated when an attempt is made to operate on a\n * dropped, or otherwise unavailable, database.\n *\n * @public\n * @category Error\n */\n\nclass MongoTopologyClosedError extends MongoAPIError {\n  constructor() {\n    let message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Topology is closed';\n    super(message);\n  }\n\n  get name() {\n    return 'MongoTopologyClosedError';\n  }\n\n}\n\nexports.MongoTopologyClosedError = MongoTopologyClosedError;\n/** @internal */\n\nconst kBeforeHandshake = Symbol('beforeHandshake');\n\nfunction isNetworkErrorBeforeHandshake(err) {\n  return err[kBeforeHandshake] === true;\n}\n\nexports.isNetworkErrorBeforeHandshake = isNetworkErrorBeforeHandshake;\n/**\n * An error indicating an issue with the network, including TCP errors and timeouts.\n * @public\n * @category Error\n */\n\nclass MongoNetworkError extends MongoError {\n  constructor(message, options) {\n    super(message);\n\n    if (options && typeof options.beforeHandshake === 'boolean') {\n      this[kBeforeHandshake] = options.beforeHandshake;\n    }\n  }\n\n  get name() {\n    return 'MongoNetworkError';\n  }\n\n}\n\nexports.MongoNetworkError = MongoNetworkError;\n/**\n * An error indicating a network timeout occurred\n * @public\n * @category Error\n *\n * @privateRemarks\n * CSFLE has a dependency on this error with an instanceof check\n */\n\nclass MongoNetworkTimeoutError extends MongoNetworkError {\n  constructor(message, options) {\n    super(message, options);\n  }\n\n  get name() {\n    return 'MongoNetworkTimeoutError';\n  }\n\n}\n\nexports.MongoNetworkTimeoutError = MongoNetworkTimeoutError;\n/**\n * An error used when attempting to parse a value (like a connection string)\n * @public\n * @category Error\n */\n\nclass MongoParseError extends MongoDriverError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoParseError';\n  }\n\n}\n\nexports.MongoParseError = MongoParseError;\n/**\n * An error generated when the user supplies malformed or unexpected arguments\n * or when a required argument or field is not provided.\n *\n *\n * @public\n * @category Error\n */\n\nclass MongoInvalidArgumentError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoInvalidArgumentError';\n  }\n\n}\n\nexports.MongoInvalidArgumentError = MongoInvalidArgumentError;\n/**\n * An error generated when a feature that is not enabled or allowed for the current server\n * configuration is used\n *\n *\n * @public\n * @category Error\n */\n\nclass MongoCompatibilityError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoCompatibilityError';\n  }\n\n}\n\nexports.MongoCompatibilityError = MongoCompatibilityError;\n/**\n * An error generated when the user fails to provide authentication credentials before attempting\n * to connect to a mongo server instance.\n *\n *\n * @public\n * @category Error\n */\n\nclass MongoMissingCredentialsError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoMissingCredentialsError';\n  }\n\n}\n\nexports.MongoMissingCredentialsError = MongoMissingCredentialsError;\n/**\n * An error generated when a required module or dependency is not present in the local environment\n *\n * @public\n * @category Error\n */\n\nclass MongoMissingDependencyError extends MongoAPIError {\n  constructor(message) {\n    super(message);\n  }\n\n  get name() {\n    return 'MongoMissingDependencyError';\n  }\n\n}\n\nexports.MongoMissingDependencyError = MongoMissingDependencyError;\n/**\n * An error signifying a general system issue\n * @public\n * @category Error\n */\n\nclass MongoSystemError extends MongoError {\n  constructor(message, reason) {\n    var _a;\n\n    if (reason && reason.error) {\n      super(reason.error.message || reason.error);\n    } else {\n      super(message);\n    }\n\n    if (reason) {\n      this.reason = reason;\n    }\n\n    this.code = (_a = reason.error) === null || _a === void 0 ? void 0 : _a.code;\n  }\n\n  get name() {\n    return 'MongoSystemError';\n  }\n\n}\n\nexports.MongoSystemError = MongoSystemError;\n/**\n * An error signifying a client-side server selection error\n * @public\n * @category Error\n */\n\nclass MongoServerSelectionError extends MongoSystemError {\n  constructor(message, reason) {\n    super(message, reason);\n  }\n\n  get name() {\n    return 'MongoServerSelectionError';\n  }\n\n}\n\nexports.MongoServerSelectionError = MongoServerSelectionError;\n\nfunction makeWriteConcernResultObject(input) {\n  const output = Object.assign({}, input);\n\n  if (output.ok === 0) {\n    output.ok = 1;\n    delete output.errmsg;\n    delete output.code;\n    delete output.codeName;\n  }\n\n  return output;\n}\n/**\n * An error thrown when the server reports a writeConcernError\n * @public\n * @category Error\n */\n\n\nclass MongoWriteConcernError extends MongoServerError {\n  constructor(message, result) {\n    if (result && Array.isArray(result.errorLabels)) {\n      message.errorLabels = result.errorLabels;\n    }\n\n    super(message);\n    this.errInfo = message.errInfo;\n\n    if (result != null) {\n      this.result = makeWriteConcernResultObject(result);\n    }\n  }\n\n  get name() {\n    return 'MongoWriteConcernError';\n  }\n\n}\n\nexports.MongoWriteConcernError = MongoWriteConcernError; // https://github.com/mongodb/specifications/blob/master/source/retryable-reads/retryable-reads.rst#retryable-error\n\nconst RETRYABLE_READ_ERROR_CODES = new Set([exports.MONGODB_ERROR_CODES.HostUnreachable, exports.MONGODB_ERROR_CODES.HostNotFound, exports.MONGODB_ERROR_CODES.NetworkTimeout, exports.MONGODB_ERROR_CODES.ShutdownInProgress, exports.MONGODB_ERROR_CODES.PrimarySteppedDown, exports.MONGODB_ERROR_CODES.SocketException, exports.MONGODB_ERROR_CODES.NotWritablePrimary, exports.MONGODB_ERROR_CODES.InterruptedAtShutdown, exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange, exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk, exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary]); // see: https://github.com/mongodb/specifications/blob/master/source/retryable-writes/retryable-writes.rst#terms\n\nconst RETRYABLE_WRITE_ERROR_CODES = new Set([...RETRYABLE_READ_ERROR_CODES, exports.MONGODB_ERROR_CODES.ExceededTimeLimit]);\n\nfunction needsRetryableWriteLabel(error, maxWireVersion) {\n  var _a, _b, _c; // pre-4.4 server, then the driver adds an error label for every valid case\n  // execute operation will only inspect the label, code/message logic is handled here\n\n\n  if (error instanceof MongoNetworkError) {\n    return true;\n  }\n\n  if (error instanceof MongoError) {\n    if ((maxWireVersion >= 9 || error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError)) && !error.hasErrorLabel(exports.MongoErrorLabel.HandshakeError)) {\n      // If we already have the error label no need to add it again. 4.4+ servers add the label.\n      // In the case where we have a handshake error, need to fall down to the logic checking\n      // the codes.\n      return false;\n    }\n  }\n\n  if (error instanceof MongoWriteConcernError) {\n    return RETRYABLE_WRITE_ERROR_CODES.has((_c = (_b = (_a = error.result) === null || _a === void 0 ? void 0 : _a.code) !== null && _b !== void 0 ? _b : error.code) !== null && _c !== void 0 ? _c : 0);\n  }\n\n  if (error instanceof MongoError && typeof error.code === 'number') {\n    return RETRYABLE_WRITE_ERROR_CODES.has(error.code);\n  }\n\n  const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n\n  if (isNotWritablePrimaryError) {\n    return true;\n  }\n\n  const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n\n  if (isNodeIsRecoveringError) {\n    return true;\n  }\n\n  return false;\n}\n\nexports.needsRetryableWriteLabel = needsRetryableWriteLabel;\n\nfunction isRetryableWriteError(error) {\n  return error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError);\n}\n\nexports.isRetryableWriteError = isRetryableWriteError;\n/** Determines whether an error is something the driver should attempt to retry */\n\nfunction isRetryableReadError(error) {\n  const hasRetryableErrorCode = typeof error.code === 'number' ? RETRYABLE_READ_ERROR_CODES.has(error.code) : false;\n\n  if (hasRetryableErrorCode) {\n    return true;\n  }\n\n  if (error instanceof MongoNetworkError) {\n    return true;\n  }\n\n  const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n\n  if (isNotWritablePrimaryError) {\n    return true;\n  }\n\n  const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n\n  if (isNodeIsRecoveringError) {\n    return true;\n  }\n\n  return false;\n}\n\nexports.isRetryableReadError = isRetryableReadError;\nconst SDAM_RECOVERING_CODES = new Set([exports.MONGODB_ERROR_CODES.ShutdownInProgress, exports.MONGODB_ERROR_CODES.PrimarySteppedDown, exports.MONGODB_ERROR_CODES.InterruptedAtShutdown, exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange, exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary]);\nconst SDAM_NOT_PRIMARY_CODES = new Set([exports.MONGODB_ERROR_CODES.NotWritablePrimary, exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk, exports.MONGODB_ERROR_CODES.LegacyNotPrimary]);\nconst SDAM_NODE_SHUTTING_DOWN_ERROR_CODES = new Set([exports.MONGODB_ERROR_CODES.InterruptedAtShutdown, exports.MONGODB_ERROR_CODES.ShutdownInProgress]);\n\nfunction isRecoveringError(err) {\n  if (typeof err.code === 'number') {\n    // If any error code exists, we ignore the error.message\n    return SDAM_RECOVERING_CODES.has(err.code);\n  }\n\n  return exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE.test(err.message) || exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(err.message);\n}\n\nfunction isNotWritablePrimaryError(err) {\n  if (typeof err.code === 'number') {\n    // If any error code exists, we ignore the error.message\n    return SDAM_NOT_PRIMARY_CODES.has(err.code);\n  }\n\n  if (isRecoveringError(err)) {\n    return false;\n  }\n\n  return exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(err.message);\n}\n\nfunction isNodeShuttingDownError(err) {\n  return !!(typeof err.code === 'number' && SDAM_NODE_SHUTTING_DOWN_ERROR_CODES.has(err.code));\n}\n\nexports.isNodeShuttingDownError = isNodeShuttingDownError;\n/**\n * Determines whether SDAM can recover from a given error. If it cannot\n * then the pool will be cleared, and server state will completely reset\n * locally.\n *\n * @see https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-master-and-node-is-recovering\n */\n\nfunction isSDAMUnrecoverableError(error) {\n  // NOTE: null check is here for a strictly pre-CMAP world, a timeout or\n  //       close event are considered unrecoverable\n  if (error instanceof MongoParseError || error == null) {\n    return true;\n  }\n\n  return isRecoveringError(error) || isNotWritablePrimaryError(error);\n}\n\nexports.isSDAMUnrecoverableError = isSDAMUnrecoverableError;\n\nfunction isNetworkTimeoutError(err) {\n  return !!(err instanceof MongoNetworkError && err.message.match(/timed out/));\n}\n\nexports.isNetworkTimeoutError = isNetworkTimeoutError;\n\nfunction isResumableError(error, wireVersion) {\n  if (error == null || !(error instanceof MongoError)) {\n    return false;\n  }\n\n  if (error instanceof MongoNetworkError) {\n    return true;\n  }\n\n  if (wireVersion != null && wireVersion >= 9) {\n    // DRIVERS-1308: For 4.4 drivers running against 4.4 servers, drivers will add a special case to treat the CursorNotFound error code as resumable\n    if (error.code === exports.MONGODB_ERROR_CODES.CursorNotFound) {\n      return true;\n    }\n\n    return error.hasErrorLabel(exports.MongoErrorLabel.ResumableChangeStreamError);\n  }\n\n  if (typeof error.code === 'number') {\n    return exports.GET_MORE_RESUMABLE_CODES.has(error.code);\n  }\n\n  return false;\n}\n\nexports.isResumableError = isResumableError;","map":{"version":3,"sources":["../src/error.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isResumableError = exports.isNetworkTimeoutError = exports.isSDAMUnrecoverableError = exports.isNodeShuttingDownError = exports.isRetryableReadError = exports.isRetryableWriteError = exports.needsRetryableWriteLabel = exports.MongoWriteConcernError = exports.MongoServerSelectionError = exports.MongoSystemError = exports.MongoMissingDependencyError = exports.MongoMissingCredentialsError = exports.MongoCompatibilityError = exports.MongoInvalidArgumentError = exports.MongoParseError = exports.MongoNetworkTimeoutError = exports.MongoNetworkError = exports.isNetworkErrorBeforeHandshake = exports.MongoTopologyClosedError = exports.MongoCursorExhaustedError = exports.MongoServerClosedError = exports.MongoCursorInUseError = exports.MongoUnexpectedServerResponseError = exports.MongoGridFSChunkError = exports.MongoGridFSStreamError = exports.MongoTailableCursorError = exports.MongoChangeStreamError = exports.MongoAWSError = exports.MongoKerberosError = exports.MongoExpiredSessionError = exports.MongoTransactionError = exports.MongoNotConnectedError = exports.MongoDecompressionError = exports.MongoBatchReExecutionError = exports.MongoRuntimeError = exports.MongoAPIError = exports.MongoDriverError = exports.MongoServerError = exports.MongoError = exports.MongoErrorLabel = exports.GET_MORE_RESUMABLE_CODES = exports.MONGODB_ERROR_CODES = exports.NODE_IS_RECOVERING_ERROR_MESSAGE = exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = void 0;\n/** @internal */\nconst kErrorLabels = Symbol('errorLabels');\n/**\n * @internal\n * The legacy error message from the server that indicates the node is not a writable primary\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\nexports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE = new RegExp('not master', 'i');\n/**\n * @internal\n * The legacy error message from the server that indicates the node is not a primary or secondary\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\nexports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE = new RegExp('not master or secondary', 'i');\n/**\n * @internal\n * The error message from the server that indicates the node is recovering\n * https://github.com/mongodb/specifications/blob/b07c26dc40d04ac20349f989db531c9845fdd755/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-writable-primary-and-node-is-recovering\n */\nexports.NODE_IS_RECOVERING_ERROR_MESSAGE = new RegExp('node is recovering', 'i');\n/** @internal MongoDB Error Codes */\nexports.MONGODB_ERROR_CODES = Object.freeze({\n    HostUnreachable: 6,\n    HostNotFound: 7,\n    NetworkTimeout: 89,\n    ShutdownInProgress: 91,\n    PrimarySteppedDown: 189,\n    ExceededTimeLimit: 262,\n    SocketException: 9001,\n    NotWritablePrimary: 10107,\n    InterruptedAtShutdown: 11600,\n    InterruptedDueToReplStateChange: 11602,\n    NotPrimaryNoSecondaryOk: 13435,\n    NotPrimaryOrSecondary: 13436,\n    StaleShardVersion: 63,\n    StaleEpoch: 150,\n    StaleConfig: 13388,\n    RetryChangeStream: 234,\n    FailedToSatisfyReadPreference: 133,\n    CursorNotFound: 43,\n    LegacyNotPrimary: 10058,\n    WriteConcernFailed: 64,\n    NamespaceNotFound: 26,\n    IllegalOperation: 20,\n    MaxTimeMSExpired: 50,\n    UnknownReplWriteConcern: 79,\n    UnsatisfiableWriteConcern: 100\n});\n// From spec@https://github.com/mongodb/specifications/blob/f93d78191f3db2898a59013a7ed5650352ef6da8/source/change-streams/change-streams.rst#resumable-error\nexports.GET_MORE_RESUMABLE_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.HostUnreachable,\n    exports.MONGODB_ERROR_CODES.HostNotFound,\n    exports.MONGODB_ERROR_CODES.NetworkTimeout,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.ExceededTimeLimit,\n    exports.MONGODB_ERROR_CODES.SocketException,\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary,\n    exports.MONGODB_ERROR_CODES.StaleShardVersion,\n    exports.MONGODB_ERROR_CODES.StaleEpoch,\n    exports.MONGODB_ERROR_CODES.StaleConfig,\n    exports.MONGODB_ERROR_CODES.RetryChangeStream,\n    exports.MONGODB_ERROR_CODES.FailedToSatisfyReadPreference,\n    exports.MONGODB_ERROR_CODES.CursorNotFound\n]);\n/** @public */\nexports.MongoErrorLabel = Object.freeze({\n    RetryableWriteError: 'RetryableWriteError',\n    TransientTransactionError: 'TransientTransactionError',\n    UnknownTransactionCommitResult: 'UnknownTransactionCommitResult',\n    ResumableChangeStreamError: 'ResumableChangeStreamError',\n    HandshakeError: 'HandshakeError'\n});\n/**\n * @public\n * @category Error\n *\n * @privateRemarks\n * CSFLE has a dependency on this error, it uses the constructor with a string argument\n */\nclass MongoError extends Error {\n    constructor(message) {\n        if (message instanceof Error) {\n            super(message.message);\n        }\n        else {\n            super(message);\n        }\n        this[kErrorLabels] = new Set();\n    }\n    get name() {\n        return 'MongoError';\n    }\n    /** Legacy name for server error responses */\n    get errmsg() {\n        return this.message;\n    }\n    /**\n     * Checks the error to see if it has an error label\n     *\n     * @param label - The error label to check for\n     * @returns returns true if the error has the provided error label\n     */\n    hasErrorLabel(label) {\n        return this[kErrorLabels].has(label);\n    }\n    addErrorLabel(label) {\n        this[kErrorLabels].add(label);\n    }\n    get errorLabels() {\n        return Array.from(this[kErrorLabels]);\n    }\n}\nexports.MongoError = MongoError;\n/**\n * An error coming from the mongo server\n *\n * @public\n * @category Error\n */\nclass MongoServerError extends MongoError {\n    constructor(message) {\n        super(message.message || message.errmsg || message.$err || 'n/a');\n        if (message.errorLabels) {\n            this[kErrorLabels] = new Set(message.errorLabels);\n        }\n        for (const name in message) {\n            if (name !== 'errorLabels' && name !== 'errmsg' && name !== 'message')\n                this[name] = message[name];\n        }\n    }\n    get name() {\n        return 'MongoServerError';\n    }\n}\nexports.MongoServerError = MongoServerError;\n/**\n * An error generated by the driver\n *\n * @public\n * @category Error\n */\nclass MongoDriverError extends MongoError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoDriverError';\n    }\n}\nexports.MongoDriverError = MongoDriverError;\n/**\n * An error generated when the driver API is used incorrectly\n *\n * @privateRemarks\n * Should **never** be directly instantiated\n *\n * @public\n * @category Error\n */\nclass MongoAPIError extends MongoDriverError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoAPIError';\n    }\n}\nexports.MongoAPIError = MongoAPIError;\n/**\n * An error generated when the driver encounters unexpected input\n * or reaches an unexpected/invalid internal state\n *\n * @privateRemarks\n * Should **never** be directly instantiated.\n *\n * @public\n * @category Error\n */\nclass MongoRuntimeError extends MongoDriverError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoRuntimeError';\n    }\n}\nexports.MongoRuntimeError = MongoRuntimeError;\n/**\n * An error generated when a batch command is re-executed after one of the commands in the batch\n * has failed\n *\n * @public\n * @category Error\n */\nclass MongoBatchReExecutionError extends MongoAPIError {\n    constructor(message = 'This batch has already been executed, create new batch to execute') {\n        super(message);\n    }\n    get name() {\n        return 'MongoBatchReExecutionError';\n    }\n}\nexports.MongoBatchReExecutionError = MongoBatchReExecutionError;\n/**\n * An error generated when the driver fails to decompress\n * data received from the server.\n *\n * @public\n * @category Error\n */\nclass MongoDecompressionError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoDecompressionError';\n    }\n}\nexports.MongoDecompressionError = MongoDecompressionError;\n/**\n * An error thrown when the user attempts to operate on a database or collection through a MongoClient\n * that has not yet successfully called the \"connect\" method\n *\n * @public\n * @category Error\n */\nclass MongoNotConnectedError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoNotConnectedError';\n    }\n}\nexports.MongoNotConnectedError = MongoNotConnectedError;\n/**\n * An error generated when the user makes a mistake in the usage of transactions.\n * (e.g. attempting to commit a transaction with a readPreference other than primary)\n *\n * @public\n * @category Error\n */\nclass MongoTransactionError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoTransactionError';\n    }\n}\nexports.MongoTransactionError = MongoTransactionError;\n/**\n * An error generated when the user attempts to operate\n * on a session that has expired or has been closed.\n *\n * @public\n * @category Error\n */\nclass MongoExpiredSessionError extends MongoAPIError {\n    constructor(message = 'Cannot use a session that has ended') {\n        super(message);\n    }\n    get name() {\n        return 'MongoExpiredSessionError';\n    }\n}\nexports.MongoExpiredSessionError = MongoExpiredSessionError;\n/**\n * A error generated when the user attempts to authenticate\n * via Kerberos, but fails to connect to the Kerberos client.\n *\n * @public\n * @category Error\n */\nclass MongoKerberosError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoKerberosError';\n    }\n}\nexports.MongoKerberosError = MongoKerberosError;\n/**\n * A error generated when the user attempts to authenticate\n * via AWS, but fails\n *\n * @public\n * @category Error\n */\nclass MongoAWSError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoAWSError';\n    }\n}\nexports.MongoAWSError = MongoAWSError;\n/**\n * An error generated when a ChangeStream operation fails to execute.\n *\n * @public\n * @category Error\n */\nclass MongoChangeStreamError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoChangeStreamError';\n    }\n}\nexports.MongoChangeStreamError = MongoChangeStreamError;\n/**\n * An error thrown when the user calls a function or method not supported on a tailable cursor\n *\n * @public\n * @category Error\n */\nclass MongoTailableCursorError extends MongoAPIError {\n    constructor(message = 'Tailable cursor does not support this operation') {\n        super(message);\n    }\n    get name() {\n        return 'MongoTailableCursorError';\n    }\n}\nexports.MongoTailableCursorError = MongoTailableCursorError;\n/** An error generated when a GridFSStream operation fails to execute.\n *\n * @public\n * @category Error\n */\nclass MongoGridFSStreamError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoGridFSStreamError';\n    }\n}\nexports.MongoGridFSStreamError = MongoGridFSStreamError;\n/**\n * An error generated when a malformed or invalid chunk is\n * encountered when reading from a GridFSStream.\n *\n * @public\n * @category Error\n */\nclass MongoGridFSChunkError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoGridFSChunkError';\n    }\n}\nexports.MongoGridFSChunkError = MongoGridFSChunkError;\n/**\n * An error generated when a **parsable** unexpected response comes from the server.\n * This is generally an error where the driver in a state expecting a certain behavior to occur in\n * the next message from MongoDB but it receives something else.\n * This error **does not** represent an issue with wire message formatting.\n *\n * #### Example\n * When an operation fails, it is the driver's job to retry it. It must perform serverSelection\n * again to make sure that it attempts the operation against a server in a good state. If server\n * selection returns a server that does not support retryable operations, this error is used.\n * This scenario is unlikely as retryable support would also have been determined on the first attempt\n * but it is possible the state change could report a selectable server that does not support retries.\n *\n * @public\n * @category Error\n */\nclass MongoUnexpectedServerResponseError extends MongoRuntimeError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoUnexpectedServerResponseError';\n    }\n}\nexports.MongoUnexpectedServerResponseError = MongoUnexpectedServerResponseError;\n/**\n * An error thrown when the user attempts to add options to a cursor that has already been\n * initialized\n *\n * @public\n * @category Error\n */\nclass MongoCursorInUseError extends MongoAPIError {\n    constructor(message = 'Cursor is already initialized') {\n        super(message);\n    }\n    get name() {\n        return 'MongoCursorInUseError';\n    }\n}\nexports.MongoCursorInUseError = MongoCursorInUseError;\n/**\n * An error generated when an attempt is made to operate\n * on a closed/closing server.\n *\n * @public\n * @category Error\n */\nclass MongoServerClosedError extends MongoAPIError {\n    constructor(message = 'Server is closed') {\n        super(message);\n    }\n    get name() {\n        return 'MongoServerClosedError';\n    }\n}\nexports.MongoServerClosedError = MongoServerClosedError;\n/**\n * An error thrown when an attempt is made to read from a cursor that has been exhausted\n *\n * @public\n * @category Error\n */\nclass MongoCursorExhaustedError extends MongoAPIError {\n    constructor(message) {\n        super(message || 'Cursor is exhausted');\n    }\n    get name() {\n        return 'MongoCursorExhaustedError';\n    }\n}\nexports.MongoCursorExhaustedError = MongoCursorExhaustedError;\n/**\n * An error generated when an attempt is made to operate on a\n * dropped, or otherwise unavailable, database.\n *\n * @public\n * @category Error\n */\nclass MongoTopologyClosedError extends MongoAPIError {\n    constructor(message = 'Topology is closed') {\n        super(message);\n    }\n    get name() {\n        return 'MongoTopologyClosedError';\n    }\n}\nexports.MongoTopologyClosedError = MongoTopologyClosedError;\n/** @internal */\nconst kBeforeHandshake = Symbol('beforeHandshake');\nfunction isNetworkErrorBeforeHandshake(err) {\n    return err[kBeforeHandshake] === true;\n}\nexports.isNetworkErrorBeforeHandshake = isNetworkErrorBeforeHandshake;\n/**\n * An error indicating an issue with the network, including TCP errors and timeouts.\n * @public\n * @category Error\n */\nclass MongoNetworkError extends MongoError {\n    constructor(message, options) {\n        super(message);\n        if (options && typeof options.beforeHandshake === 'boolean') {\n            this[kBeforeHandshake] = options.beforeHandshake;\n        }\n    }\n    get name() {\n        return 'MongoNetworkError';\n    }\n}\nexports.MongoNetworkError = MongoNetworkError;\n/**\n * An error indicating a network timeout occurred\n * @public\n * @category Error\n *\n * @privateRemarks\n * CSFLE has a dependency on this error with an instanceof check\n */\nclass MongoNetworkTimeoutError extends MongoNetworkError {\n    constructor(message, options) {\n        super(message, options);\n    }\n    get name() {\n        return 'MongoNetworkTimeoutError';\n    }\n}\nexports.MongoNetworkTimeoutError = MongoNetworkTimeoutError;\n/**\n * An error used when attempting to parse a value (like a connection string)\n * @public\n * @category Error\n */\nclass MongoParseError extends MongoDriverError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoParseError';\n    }\n}\nexports.MongoParseError = MongoParseError;\n/**\n * An error generated when the user supplies malformed or unexpected arguments\n * or when a required argument or field is not provided.\n *\n *\n * @public\n * @category Error\n */\nclass MongoInvalidArgumentError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoInvalidArgumentError';\n    }\n}\nexports.MongoInvalidArgumentError = MongoInvalidArgumentError;\n/**\n * An error generated when a feature that is not enabled or allowed for the current server\n * configuration is used\n *\n *\n * @public\n * @category Error\n */\nclass MongoCompatibilityError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoCompatibilityError';\n    }\n}\nexports.MongoCompatibilityError = MongoCompatibilityError;\n/**\n * An error generated when the user fails to provide authentication credentials before attempting\n * to connect to a mongo server instance.\n *\n *\n * @public\n * @category Error\n */\nclass MongoMissingCredentialsError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoMissingCredentialsError';\n    }\n}\nexports.MongoMissingCredentialsError = MongoMissingCredentialsError;\n/**\n * An error generated when a required module or dependency is not present in the local environment\n *\n * @public\n * @category Error\n */\nclass MongoMissingDependencyError extends MongoAPIError {\n    constructor(message) {\n        super(message);\n    }\n    get name() {\n        return 'MongoMissingDependencyError';\n    }\n}\nexports.MongoMissingDependencyError = MongoMissingDependencyError;\n/**\n * An error signifying a general system issue\n * @public\n * @category Error\n */\nclass MongoSystemError extends MongoError {\n    constructor(message, reason) {\n        var _a;\n        if (reason && reason.error) {\n            super(reason.error.message || reason.error);\n        }\n        else {\n            super(message);\n        }\n        if (reason) {\n            this.reason = reason;\n        }\n        this.code = (_a = reason.error) === null || _a === void 0 ? void 0 : _a.code;\n    }\n    get name() {\n        return 'MongoSystemError';\n    }\n}\nexports.MongoSystemError = MongoSystemError;\n/**\n * An error signifying a client-side server selection error\n * @public\n * @category Error\n */\nclass MongoServerSelectionError extends MongoSystemError {\n    constructor(message, reason) {\n        super(message, reason);\n    }\n    get name() {\n        return 'MongoServerSelectionError';\n    }\n}\nexports.MongoServerSelectionError = MongoServerSelectionError;\nfunction makeWriteConcernResultObject(input) {\n    const output = Object.assign({}, input);\n    if (output.ok === 0) {\n        output.ok = 1;\n        delete output.errmsg;\n        delete output.code;\n        delete output.codeName;\n    }\n    return output;\n}\n/**\n * An error thrown when the server reports a writeConcernError\n * @public\n * @category Error\n */\nclass MongoWriteConcernError extends MongoServerError {\n    constructor(message, result) {\n        if (result && Array.isArray(result.errorLabels)) {\n            message.errorLabels = result.errorLabels;\n        }\n        super(message);\n        this.errInfo = message.errInfo;\n        if (result != null) {\n            this.result = makeWriteConcernResultObject(result);\n        }\n    }\n    get name() {\n        return 'MongoWriteConcernError';\n    }\n}\nexports.MongoWriteConcernError = MongoWriteConcernError;\n// https://github.com/mongodb/specifications/blob/master/source/retryable-reads/retryable-reads.rst#retryable-error\nconst RETRYABLE_READ_ERROR_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.HostUnreachable,\n    exports.MONGODB_ERROR_CODES.HostNotFound,\n    exports.MONGODB_ERROR_CODES.NetworkTimeout,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.SocketException,\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary\n]);\n// see: https://github.com/mongodb/specifications/blob/master/source/retryable-writes/retryable-writes.rst#terms\nconst RETRYABLE_WRITE_ERROR_CODES = new Set([\n    ...RETRYABLE_READ_ERROR_CODES,\n    exports.MONGODB_ERROR_CODES.ExceededTimeLimit\n]);\nfunction needsRetryableWriteLabel(error, maxWireVersion) {\n    var _a, _b, _c;\n    // pre-4.4 server, then the driver adds an error label for every valid case\n    // execute operation will only inspect the label, code/message logic is handled here\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    if (error instanceof MongoError) {\n        if ((maxWireVersion >= 9 || error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError)) &&\n            !error.hasErrorLabel(exports.MongoErrorLabel.HandshakeError)) {\n            // If we already have the error label no need to add it again. 4.4+ servers add the label.\n            // In the case where we have a handshake error, need to fall down to the logic checking\n            // the codes.\n            return false;\n        }\n    }\n    if (error instanceof MongoWriteConcernError) {\n        return RETRYABLE_WRITE_ERROR_CODES.has((_c = (_b = (_a = error.result) === null || _a === void 0 ? void 0 : _a.code) !== null && _b !== void 0 ? _b : error.code) !== null && _c !== void 0 ? _c : 0);\n    }\n    if (error instanceof MongoError && typeof error.code === 'number') {\n        return RETRYABLE_WRITE_ERROR_CODES.has(error.code);\n    }\n    const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n    if (isNotWritablePrimaryError) {\n        return true;\n    }\n    const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n    if (isNodeIsRecoveringError) {\n        return true;\n    }\n    return false;\n}\nexports.needsRetryableWriteLabel = needsRetryableWriteLabel;\nfunction isRetryableWriteError(error) {\n    return error.hasErrorLabel(exports.MongoErrorLabel.RetryableWriteError);\n}\nexports.isRetryableWriteError = isRetryableWriteError;\n/** Determines whether an error is something the driver should attempt to retry */\nfunction isRetryableReadError(error) {\n    const hasRetryableErrorCode = typeof error.code === 'number' ? RETRYABLE_READ_ERROR_CODES.has(error.code) : false;\n    if (hasRetryableErrorCode) {\n        return true;\n    }\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    const isNotWritablePrimaryError = exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(error.message);\n    if (isNotWritablePrimaryError) {\n        return true;\n    }\n    const isNodeIsRecoveringError = exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(error.message);\n    if (isNodeIsRecoveringError) {\n        return true;\n    }\n    return false;\n}\nexports.isRetryableReadError = isRetryableReadError;\nconst SDAM_RECOVERING_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress,\n    exports.MONGODB_ERROR_CODES.PrimarySteppedDown,\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.InterruptedDueToReplStateChange,\n    exports.MONGODB_ERROR_CODES.NotPrimaryOrSecondary\n]);\nconst SDAM_NOT_PRIMARY_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.NotWritablePrimary,\n    exports.MONGODB_ERROR_CODES.NotPrimaryNoSecondaryOk,\n    exports.MONGODB_ERROR_CODES.LegacyNotPrimary\n]);\nconst SDAM_NODE_SHUTTING_DOWN_ERROR_CODES = new Set([\n    exports.MONGODB_ERROR_CODES.InterruptedAtShutdown,\n    exports.MONGODB_ERROR_CODES.ShutdownInProgress\n]);\nfunction isRecoveringError(err) {\n    if (typeof err.code === 'number') {\n        // If any error code exists, we ignore the error.message\n        return SDAM_RECOVERING_CODES.has(err.code);\n    }\n    return (exports.LEGACY_NOT_PRIMARY_OR_SECONDARY_ERROR_MESSAGE.test(err.message) ||\n        exports.NODE_IS_RECOVERING_ERROR_MESSAGE.test(err.message));\n}\nfunction isNotWritablePrimaryError(err) {\n    if (typeof err.code === 'number') {\n        // If any error code exists, we ignore the error.message\n        return SDAM_NOT_PRIMARY_CODES.has(err.code);\n    }\n    if (isRecoveringError(err)) {\n        return false;\n    }\n    return exports.LEGACY_NOT_WRITABLE_PRIMARY_ERROR_MESSAGE.test(err.message);\n}\nfunction isNodeShuttingDownError(err) {\n    return !!(typeof err.code === 'number' && SDAM_NODE_SHUTTING_DOWN_ERROR_CODES.has(err.code));\n}\nexports.isNodeShuttingDownError = isNodeShuttingDownError;\n/**\n * Determines whether SDAM can recover from a given error. If it cannot\n * then the pool will be cleared, and server state will completely reset\n * locally.\n *\n * @see https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring.rst#not-master-and-node-is-recovering\n */\nfunction isSDAMUnrecoverableError(error) {\n    // NOTE: null check is here for a strictly pre-CMAP world, a timeout or\n    //       close event are considered unrecoverable\n    if (error instanceof MongoParseError || error == null) {\n        return true;\n    }\n    return isRecoveringError(error) || isNotWritablePrimaryError(error);\n}\nexports.isSDAMUnrecoverableError = isSDAMUnrecoverableError;\nfunction isNetworkTimeoutError(err) {\n    return !!(err instanceof MongoNetworkError && err.message.match(/timed out/));\n}\nexports.isNetworkTimeoutError = isNetworkTimeoutError;\nfunction isResumableError(error, wireVersion) {\n    if (error == null || !(error instanceof MongoError)) {\n        return false;\n    }\n    if (error instanceof MongoNetworkError) {\n        return true;\n    }\n    if (wireVersion != null && wireVersion >= 9) {\n        // DRIVERS-1308: For 4.4 drivers running against 4.4 servers, drivers will add a special case to treat the CursorNotFound error code as resumable\n        if (error.code === exports.MONGODB_ERROR_CODES.CursorNotFound) {\n            return true;\n        }\n        return error.hasErrorLabel(exports.MongoErrorLabel.ResumableChangeStreamError);\n    }\n    if (typeof error.code === 'number') {\n        return exports.GET_MORE_RESUMABLE_CODES.has(error.code);\n    }\n    return false;\n}\nexports.isResumableError = isResumableError;\n//# sourceMappingURL=error.js.map"]},"metadata":{},"sourceType":"script"}